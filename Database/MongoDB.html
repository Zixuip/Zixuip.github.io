<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>MongoDB快速上手 | Zixu知识笔记</title>
    <meta name="generator" content="VuePress 1.5.2">
    
    <meta name="description" content="这是一个知识点总结，JavaScript、HTML5、CSS、Vue等">
    <link rel="preload" href="/assets/css/0.styles.34d67128.css" as="style"><link rel="preload" href="/assets/js/app.294fffad.js" as="script"><link rel="preload" href="/assets/js/2.f1532a20.js" as="script"><link rel="preload" href="/assets/js/4.1433da08.js" as="script"><link rel="prefetch" href="/assets/js/10.2900798d.js"><link rel="prefetch" href="/assets/js/11.1ec66009.js"><link rel="prefetch" href="/assets/js/12.b6c2d62a.js"><link rel="prefetch" href="/assets/js/13.f5881c68.js"><link rel="prefetch" href="/assets/js/14.aca440c5.js"><link rel="prefetch" href="/assets/js/3.99e5e321.js"><link rel="prefetch" href="/assets/js/5.b3fe197c.js"><link rel="prefetch" href="/assets/js/6.86a087fc.js"><link rel="prefetch" href="/assets/js/7.a75e6b0f.js"><link rel="prefetch" href="/assets/js/8.e63063d9.js"><link rel="prefetch" href="/assets/js/9.658a7c7e.js">
    <link rel="stylesheet" href="/assets/css/0.styles.34d67128.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Zixu知识笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/about.html" class="nav-link">
  About
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="JavaScript" class="dropdown-title"><span class="title">JavaScript</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/JavaScript/JS高级.html" class="nav-link">
  JS高级
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/红皮书.html" class="nav-link">
  高级程序设计(第三版)
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/ES6.html" class="nav-link">
  ES6
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/事件冒泡和捕获.html" class="nav-link">
  事件冒泡和捕获
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/事件委托.html" class="nav-link">
  事件委托
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/事件循环.html" class="nav-link">
  事件循环
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Database/MongoDB.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  MongoDB基础
</a></li></ul></div></div><div class="nav-item"><a href="/Echarts/Echarts.html" class="nav-link">
  Echart
</a></div> <a href="https://github.com/Zixuip" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/about.html" class="nav-link">
  About
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="JavaScript" class="dropdown-title"><span class="title">JavaScript</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/JavaScript/JS高级.html" class="nav-link">
  JS高级
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/红皮书.html" class="nav-link">
  高级程序设计(第三版)
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/ES6.html" class="nav-link">
  ES6
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/事件冒泡和捕获.html" class="nav-link">
  事件冒泡和捕获
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/事件委托.html" class="nav-link">
  事件委托
</a></li><li class="dropdown-item"><!----> <a href="/JavaScript/事件循环.html" class="nav-link">
  事件循环
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Database/MongoDB.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  MongoDB基础
</a></li></ul></div></div><div class="nav-item"><a href="/Echarts/Echarts.html" class="nav-link">
  Echart
</a></div> <a href="https://github.com/Zixuip" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>MongoDB快速上手</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Database/MongoDB.html#_1、相关概念" class="sidebar-link">1、相关概念</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Database/MongoDB.html#_1-1-业务应用场景" class="sidebar-link">1.1 业务应用场景</a></li><li class="sidebar-sub-header"><a href="/Database/MongoDB.html#_1-2-mongodb-简介" class="sidebar-link">1.2 MongoDB 简介</a></li></ul></li><li><a href="/Database/MongoDB.html#_2-基本常用命令" class="sidebar-link">2. 基本常用命令</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Database/MongoDB.html#_2-1-文档基本crud" class="sidebar-link">2.1 文档基本CRUD</a></li><li class="sidebar-sub-header"><a href="/Database/MongoDB.html#_2-1-1-创建create" class="sidebar-link">2.1.1 创建Create</a></li><li class="sidebar-sub-header"><a href="/Database/MongoDB.html#_2-1-2-查询-read" class="sidebar-link">2.1.2 查询 Read</a></li><li class="sidebar-sub-header"><a href="/Database/MongoDB.html#_2-1-3-更新-update" class="sidebar-link">2.1.3 更新 Update</a></li><li class="sidebar-sub-header"><a href="/Database/MongoDB.html#_2-1-4-删除-delete" class="sidebar-link">2.1.4 删除 Delete</a></li><li class="sidebar-sub-header"><a href="/Database/MongoDB.html#_2-2-文档排序和投影（sort-projection）" class="sidebar-link">2.2 文档排序和投影（sort &amp; projection）</a></li><li class="sidebar-sub-header"><a href="/Database/MongoDB.html#_2-2-1-排序-sort" class="sidebar-link">2.2.1 排序 Sort</a></li><li class="sidebar-sub-header"><a href="/Database/MongoDB.html#_2-2-2-投影-projection" class="sidebar-link">2.2.2 投影 Projection</a></li><li class="sidebar-sub-header"><a href="/Database/MongoDB.html#_2-3-foreach" class="sidebar-link">2.3 forEach()</a></li><li class="sidebar-sub-header"><a href="/Database/MongoDB.html#_2-4-其他查询方式" class="sidebar-link">2.4 其他查询方式</a></li><li class="sidebar-sub-header"><a href="/Database/MongoDB.html#_2-4-1-正则表达式" class="sidebar-link">2.4.1 正则表达式</a></li><li class="sidebar-sub-header"><a href="/Database/MongoDB.html#_2-4-2-比较查询" class="sidebar-link">2.4.2 比较查询</a></li><li class="sidebar-sub-header"><a href="/Database/MongoDB.html#_2-4-3-包含查询" class="sidebar-link">2.4.3 包含查询</a></li><li class="sidebar-sub-header"><a href="/Database/MongoDB.html#_2-5-常用命令小结" class="sidebar-link">2.5 常用命令小结</a></li></ul></li><li><a href="/Database/MongoDB.html#_3-文档间的对应关系" class="sidebar-link">3. 文档间的对应关系</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/Database/MongoDB.html#_4-mongodb-的索引" class="sidebar-link">4. MongoDB 的索引</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Database/MongoDB.html#_4-1-索引的类型" class="sidebar-link">4.1 索引的类型</a></li><li class="sidebar-sub-header"><a href="/Database/MongoDB.html#_4-1-1-单字段索引（single-field-index）" class="sidebar-link">4.1.1 单字段索引（Single Field Index）</a></li><li class="sidebar-sub-header"><a href="/Database/MongoDB.html#_4-1-2-复合索引（compound-index）" class="sidebar-link">4.1.2 复合索引（Compound Index）</a></li><li class="sidebar-sub-header"><a href="/Database/MongoDB.html#_4-1-3-其他索引" class="sidebar-link">4.1.3 其他索引</a></li><li class="sidebar-sub-header"><a href="/Database/MongoDB.html#_4-2-索引的管理操作" class="sidebar-link">4.2 索引的管理操作</a></li><li class="sidebar-sub-header"><a href="/Database/MongoDB.html#_4-2-1-索引的查看" class="sidebar-link">4.2.1 索引的查看</a></li><li class="sidebar-sub-header"><a href="/Database/MongoDB.html#_4-2-2-索引的创建" class="sidebar-link">4.2.2 索引的创建</a></li><li class="sidebar-sub-header"><a href="/Database/MongoDB.html#_4-2-3-索引的删除" class="sidebar-link">4.2.3 索引的删除</a></li><li class="sidebar-sub-header"><a href="/Database/MongoDB.html#_4-3-索引的使用" class="sidebar-link">4.3 索引的使用</a></li><li class="sidebar-sub-header"><a href="/Database/MongoDB.html#_4-3-1-执行计划" class="sidebar-link">4.3.1 执行计划</a></li><li class="sidebar-sub-header"><a href="/Database/MongoDB.html#_4-3-2-涵盖的查询" class="sidebar-link">4.3.2 涵盖的查询</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="mongodb快速上手"><a href="#mongodb快速上手" class="header-anchor">#</a> MongoDB快速上手</h1> <h2 id="_1、相关概念"><a href="#_1、相关概念" class="header-anchor">#</a> 1、相关概念</h2> <h3 id="_1-1-业务应用场景"><a href="#_1-1-业务应用场景" class="header-anchor">#</a> 1.1 业务应用场景</h3> <p>传统的关系型数据库（如MySQL），在数据操作的“三高”需求以及应对Web2.0的网站需求面前，显得力不从心</p> <p>数据库的 <strong>“三高”</strong> 需求：</p> <blockquote><p>高并发、高性能、高可用：</p> <ul><li>High performance - 高并发读写的需求</li> <li>High Storage - （海量数据）高效存储和访问的需求</li> <li>High Scalability &amp;&amp; High Availability - 高扩展性和高可用性的需求</li></ul></blockquote> <p><strong>Web2.0</strong></p> <blockquote><p>称为<strong>参与式网络</strong>或<strong>社交网络</strong>，指以用户为目标，强调用户生成内容、易用性、参与文化和相互操作行的网站</p></blockquote> <p><strong>具体应用场景</strong>：</p> <p>共同的特点：1.<strong>数据量大</strong>、2.<strong>写入操作频繁</strong>、3.<strong>价值较低的数据</strong>，对<strong>事务性</strong>要求不高</p> <blockquote><p>数据库的事务性：把多条语句作为一个整体进行操作的功能，它可以确保该事务范围内的所有操作都可以全部成功或者全部失败</p> <p>数据库事务具有ACID这四个特性：</p> <ul><li>A：Atomic，原子性，将所有所有SQL作为原子工作单位，要么全部执行，要么全部不执行；</li> <li>C：Consistent，一致性，事务完成后，所有数据的状态都是一致的；如A转账给B，100块。那A账户-100，而B账户则+100；</li> <li>I：Isolation，隔离性，如果有多个事务并发执行，每个事务做出的修改必须与其他事务隔离；</li> <li>D：Duration，持久性，即事务完成后，对数据库数据的修改被持久化存储</li></ul></blockquote> <ul><li><p><strong>社交场景</strong>：使用 MongoDB 存储存储用户信息，以及用户发表的朋友圈信息，通过地理位置索引实现附近的人、地点等功能。</p></li> <li><p><strong>游戏场景</strong>：使用 MongoDB 存储游戏用户信息，用户的装备、积分等直接以内嵌文档的形式存储，方便查询、高效率存储和访问。</p></li> <li><p><strong>物流场景</strong>：使用 MongoDB 存储订单信息，订单状态在运送过程中会不断更新，以 MongoDB 内嵌数组的形式来存储，一次查询就能将 订单所有的变更读取出来。</p></li> <li><p><strong>物联网场景</strong>：使用 MongoDB 存储所有接入的智能设备信息，以及设备汇报的日志信息，并对这些信息进行多维度的分析。</p></li> <li><p><strong>视频直播</strong>：使用 MongoDB 存储用户信息、点赞互动信息等。</p></li> <li><p>除了以上，还需要考虑以下问题：</p> <blockquote><ul><li>应用不需要事务及复杂 JOIN 支持</li> <li>新应用，需求会变，数据模型无法确定，想快速迭代开发</li> <li>应用需要 2000 - 3000 以上的读写QPS（更高也可以）</li> <li>应用需要 TB 甚至 PB 级别数据存储</li> <li>应用发展迅速，需要能快速水平扩展</li> <li>应用要求存储的数据不丢失</li> <li>应用需要 <code>99.999%</code> 高可用</li> <li>应用需要大量的地理位置查询、文本查询</li></ul></blockquote></li></ul> <h3 id="_1-2-mongodb-简介"><a href="#_1-2-mongodb-简介" class="header-anchor">#</a> 1.2 MongoDB 简介</h3> <blockquote><p>MongoDB是一个开源、高性能、无模式的文档型数据库，是NoSQL数据库的一种。并且是最像关系型数据库（MySQL）的非关系型数据库。它的数据结构是一种类似JSON的BSON。MongoDB中记录的是每个文档，它是一个由字段和值对（ﬁeld:value）组成的数据结构</p></blockquote> <p>MongoDB 数据模型是面向文档的，所谓的文档是一种类似JSON的结构</p> <ul><li>数据库（database）：数据库是一个仓库，存储集合（collection）</li> <li>集合（collection）：类似于数组，在集合中存放文档</li> <li>文档（document）：文档对象是数据库的最小存储单位，通常情况下，我们操作和存储的都是文档</li></ul> <p>​    在 MongoDB 中，数据库和集合都不需要手动创建，当我们创建文档时，如果文档所在的集合或者数据库不存在，<strong>则会自动创建数据库或者集合</strong></p> <p><strong>数据库（databases）</strong></p> <table><thead><tr><th>操作</th> <th>语法</th></tr></thead> <tbody><tr><td>查看所有数据库</td> <td><code>show dbs;</code> 或 <code>show databases;</code></td></tr> <tr><td>查看当前数据库</td> <td><code>db;</code></td></tr> <tr><td>切换到某数据库 (<strong>若数据库不存在则创建数据库</strong>)</td> <td><code>use &lt;db_name&gt;;</code></td></tr> <tr><td>删除当前数据库</td> <td><code>db.dropDatabase();</code></td></tr></tbody></table> <p><strong>集合 (collection) 管理语法</strong></p> <table><thead><tr><th>操作</th> <th>语法</th></tr></thead> <tbody><tr><td>查看所有集合</td> <td><code>show collections;</code></td></tr> <tr><td>创建集合</td> <td><code>db.createCollection(&quot;&lt;collection_name&gt;&quot;);</code></td></tr> <tr><td>删除集合</td> <td><code>db.&lt;collection_name&gt;.drop()</code></td></tr></tbody></table> <h2 id="_2-基本常用命令"><a href="#_2-基本常用命令" class="header-anchor">#</a> 2. 基本常用命令</h2> <p>默认保留的数据库</p> <ul><li><strong>admin</strong>: 从权限角度考虑, 这是 <code>root</code> 数据库, 如果将一个用户添加到这个数据库, 这个用户自动继承所有数据库的权限, 一些特定的服务器端命令也只能从这个数据库运行, 比如列出所有的数据库或者关闭服务器</li> <li><strong>local</strong>: 数据永远不会被复制, 可以用来存储限于本地的单台服务器的集合 (部署集群, 分片等)</li> <li><strong>config</strong>: Mongo 用于分片设置时, <code>config</code> 数据库在内部使用, 用来保存分片的相关信息</li></ul> <blockquote><div class="language-javascript extra-class"><pre class="language-javascript"><code>$ show dbs

$ use <span class="token operator">&lt;</span>collection_name<span class="token operator">&gt;</span>

$ show collections
</code></pre></div><p>当使用 <code>use articledb</code> 的时候. <code>articledb</code> 其实存放在内存之中, 当 <code>articledb</code> 中存在一个 collection 之后, mongo 才会将这个数据库持久化到硬盘之中.</p></blockquote> <h3 id="_2-1-文档基本crud"><a href="#_2-1-文档基本crud" class="header-anchor">#</a> 2.1 文档基本CRUD</h3> <h3 id="_2-1-1-创建create"><a href="#_2-1-1-创建create" class="header-anchor">#</a> 2.1.1 创建Create</h3> <ul><li>使用 <code>db.&lt;collection_name&gt;.insertOne()</code> 向集合中添加<em>一个文档</em>, 参数一个 Json 格式的文档</li> <li>使用 <code>db.&lt;collection_name&gt;.insertMany()</code> 向集合中添加<em>多个文档</em>, 参数为 Json 文档数组</li></ul> <p><img src="/assets/img/2.1.1.88b03d84.png" alt="image"></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>db<span class="token punctuation">.</span>collection<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token operator">&lt;</span>document or array <span class="token keyword">of</span> documents<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  writeConcern<span class="token operator">:</span> <span class="token operator">&lt;</span>document<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  ordered<span class="token operator">:</span> <span class="token operator">&lt;</span>boolean<span class="token operator">&gt;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 向集合中添加一个文档</span>
db<span class="token punctuation">.</span>collection<span class="token punctuation">.</span><span class="token function">insertOne</span><span class="token punctuation">(</span>
   <span class="token punctuation">{</span> item<span class="token operator">:</span> <span class="token string">&quot;canvas&quot;</span><span class="token punctuation">,</span> qty<span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span> tags<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;cotton&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> size<span class="token operator">:</span> <span class="token punctuation">{</span> h<span class="token operator">:</span> <span class="token number">28</span><span class="token punctuation">,</span> w<span class="token operator">:</span> <span class="token number">35.5</span><span class="token punctuation">,</span> uom<span class="token operator">:</span> <span class="token string">&quot;cm&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
<span class="token comment">// 向集合中添加多个文档</span>
db<span class="token punctuation">.</span>collection<span class="token punctuation">.</span><span class="token function">insertMany</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
   <span class="token punctuation">{</span> item<span class="token operator">:</span> <span class="token string">&quot;journal&quot;</span><span class="token punctuation">,</span> qty<span class="token operator">:</span> <span class="token number">25</span><span class="token punctuation">,</span> tags<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;blank&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;red&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> size<span class="token operator">:</span> <span class="token punctuation">{</span> h<span class="token operator">:</span> <span class="token number">14</span><span class="token punctuation">,</span> w<span class="token operator">:</span> <span class="token number">21</span><span class="token punctuation">,</span> uom<span class="token operator">:</span> <span class="token string">&quot;cm&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
   <span class="token punctuation">{</span> item<span class="token operator">:</span> <span class="token string">&quot;mat&quot;</span><span class="token punctuation">,</span> qty<span class="token operator">:</span> <span class="token number">85</span><span class="token punctuation">,</span> tags<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;gray&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> size<span class="token operator">:</span> <span class="token punctuation">{</span> h<span class="token operator">:</span> <span class="token number">27.9</span><span class="token punctuation">,</span> w<span class="token operator">:</span> <span class="token number">35.5</span><span class="token punctuation">,</span> uom<span class="token operator">:</span> <span class="token string">&quot;cm&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
   <span class="token punctuation">{</span> item<span class="token operator">:</span> <span class="token string">&quot;mousepad&quot;</span><span class="token punctuation">,</span> qty<span class="token operator">:</span> <span class="token number">25</span><span class="token punctuation">,</span> tags<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;gel&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;blue&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> size<span class="token operator">:</span> <span class="token punctuation">{</span> h<span class="token operator">:</span> <span class="token number">19</span><span class="token punctuation">,</span> w<span class="token operator">:</span> <span class="token number">22.85</span><span class="token punctuation">,</span> uom<span class="token operator">:</span> <span class="token string">&quot;cm&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>注</strong>：当我们向 <code>collection</code> 中插入 <code>document</code> 文档时，如果没有给文档指定 <code>_id</code> 属性，那么数据库会为文档自动添加 <code>_id</code> field, 并且值类型是 <code>ObjectId(xxx)</code>, 就是文档的唯一标识, 类似于 relational database 里的 <code>primary key</code></p> <blockquote><ul><li>mongo 中的数字，默认情况下是 double 类型，如果要存整型，必须使用函数 <code>NumberInt(整型数字)</code>，否则取出来就有问题了</li> <li>插入当前日期可以使用 <code>new Date()</code></li></ul></blockquote> <p>如果某条数据插入失败，将会终止插入，但已经插入成功的数据<strong>不会回滚掉</strong>。 因为批量插入由于数据较多容易出现失败，因此，可以使用 <code>try catch</code> 进行异常捕捉处理，测试的时候可以不处理。</p> <h3 id="_2-1-2-查询-read"><a href="#_2-1-2-查询-read" class="header-anchor">#</a> 2.1.2 查询 Read</h3> <ul><li>使用 <code>db.&lt;collection_name&gt;.find()</code> 方法对集合进行查询, 接受一个 json 格式的查询条件. 返回的是一个<strong>数组</strong></li> <li><code>db.&lt;collection_name&gt;.findOne()</code> 查询集合中符合条件的第一个文档，返回的是一个<strong>对象</strong></li></ul> <p><img src="/assets/img/2.1.2.f38379b9.png" alt="image"></p> <p>可以使用 <code>$in</code> 操作符表示<strong>范围查询</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>db<span class="token punctuation">.</span><span class="token operator">&lt;</span>collection_name<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span> <span class="token punctuation">{</span> status<span class="token operator">:</span> <span class="token punctuation">{</span> $<span class="token keyword">in</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">&quot;A&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;D&quot;</span> <span class="token punctuation">]</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">)</span>
</code></pre></div><p>多个查询条件用逗号分隔, 表示 <code>AND</code> 的关系</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>db<span class="token punctuation">.</span><span class="token operator">&lt;</span>collection_name<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span> <span class="token punctuation">{</span> status<span class="token operator">:</span> <span class="token string">&quot;A&quot;</span><span class="token punctuation">,</span> qty<span class="token operator">:</span> <span class="token punctuation">{</span> $lt<span class="token operator">:</span> <span class="token number">30</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">)</span>
</code></pre></div><p>等价于下面 sql 语句</p> <div class="language-mysql extra-class"><pre class="language-text"><code>SELECT * FROM inventory WHERE status = &quot;A&quot; OR qty &lt; 30
</code></pre></div><p>联合使用 <code>AND</code> 和 <code>OR</code> 的查询语句</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>db<span class="token punctuation">.</span><span class="token operator">&lt;</span>collection_name<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span> <span class="token punctuation">{</span>
     status<span class="token operator">:</span> <span class="token string">&quot;A&quot;</span><span class="token punctuation">,</span>
     $or<span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token punctuation">{</span> qty<span class="token operator">:</span> <span class="token punctuation">{</span> $lt<span class="token operator">:</span> <span class="token number">30</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> item<span class="token operator">:</span> <span class="token regex">/^p/</span> <span class="token punctuation">}</span> <span class="token punctuation">]</span>
<span class="token punctuation">}</span> <span class="token punctuation">)</span>
</code></pre></div><p>在 terminal 中查看结果可能不是很方便, 所以我们可以用 <code>pretty()</code> 来帮助阅读</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>db<span class="token punctuation">.</span><span class="token operator">&lt;</span>collection_name<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pretty</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>匹配内容</strong>：(.pretty()=&gt;作用是格式化返回来的代码)</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>db<span class="token punctuation">.</span><span class="token operator">&lt;</span>collection_name<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  comments<span class="token operator">:</span> <span class="token punctuation">{</span>
    $elemMatch<span class="token operator">:</span> <span class="token punctuation">{</span>
      user<span class="token operator">:</span> <span class="token string">'Harry Potter'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pretty</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 正则表达式</span>
db<span class="token punctuation">.</span><span class="token operator">&lt;</span>collection_name<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> content <span class="token operator">:</span> <span class="token regex">/once/</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>创建索引</strong>：(.pretty()=&gt;作用是格式化返回来的代码)</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>db<span class="token punctuation">.</span><span class="token operator">&lt;</span>collection_name<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token function">createIndex</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token punctuation">{</span> title <span class="token operator">:</span> <span class="token string">'text'</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 文本搜索</span>
<span class="token comment">// will return document with title &quot;Post One&quot;</span>
<span class="token comment">// if there is no more posts created</span>
db<span class="token punctuation">.</span><span class="token operator">&lt;</span>collection_name<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  $text <span class="token operator">:</span> <span class="token punctuation">{</span>
    $search <span class="token operator">:</span> <span class="token string">&quot;\&quot;Post O\&quot;&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pretty</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="_2-1-3-更新-update"><a href="#_2-1-3-更新-update" class="header-anchor">#</a> 2.1.3 更新 Update</h3> <ul><li>使用 <code>db.&lt;collection_name&gt;.updateOne(&lt;filter&gt;, &lt;update&gt;, &lt;options&gt;)</code> 方法修改一个匹配 <code>&lt;filter&gt;</code> 条件的文档</li> <li>使用 <code>db.&lt;collection_name&gt;.updateMany(&lt;filter&gt;, &lt;update&gt;, &lt;options&gt;)</code> 方法修改所有匹配 <code>&lt;filter&gt;</code> 条件的文档</li> <li>使用 <code>db.&lt;collection_name&gt;.replaceOne(&lt;filter&gt;, &lt;update&gt;, &lt;options&gt;)</code> 方法<strong>替换</strong>一个匹配 <code>&lt;filter&gt;</code> 条件的文档</li> <li><code>db.&lt;collection_name&gt;.update(查询对象, 新对象)</code> 默认情况下会使用新对象替换旧对象</li></ul> <p>其中 <code>&lt;filter&gt;</code> 参数与查询方法中的条件参数用法一致.</p> <p>如果需要修改指定的属性，而不是替换需要用“修改操作符”来进行修改</p> <ul><li><code>$set</code> 修改文档中的制定属性</li></ul> <p>其中最常用的修改操作符即为<code>$set</code>和<code>$unset</code>,分别表示<strong>赋值</strong>和<strong>取消赋值</strong>.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>db<span class="token punctuation">.</span><span class="token operator">&lt;</span>collection_name<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token function">updateOne</span><span class="token punctuation">(</span>
    <span class="token punctuation">{</span> item<span class="token operator">:</span> <span class="token string">&quot;paper&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        $<span class="token keyword">set</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;size.uom&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cm&quot;</span><span class="token punctuation">,</span> status<span class="token operator">:</span> <span class="token string">&quot;P&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        $currentDate<span class="token operator">:</span> <span class="token punctuation">{</span> lastModified<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span>

db<span class="token punctuation">.</span><span class="token operator">&lt;</span>collection_name<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token function">updateMany</span><span class="token punctuation">(</span>
    <span class="token punctuation">{</span> qty<span class="token operator">:</span> <span class="token punctuation">{</span> $lt<span class="token operator">:</span> <span class="token number">50</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        $<span class="token keyword">set</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token string">&quot;size.uom&quot;</span><span class="token operator">:</span> <span class="token string">&quot;in&quot;</span><span class="token punctuation">,</span> status<span class="token operator">:</span> <span class="token string">&quot;P&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        $currentDate<span class="token operator">:</span> <span class="token punctuation">{</span> lastModified<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
</code></pre></div><ul><li>uses the <a href="https://docs.mongodb.com/manual/reference/operator/update/set/#up._S_set" target="_blank" rel="noopener noreferrer"><code>$set</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> operator to update the value of the <code>size.uom</code> field to <code>&quot;cm&quot;</code> and the value of the <code>status</code> field to <code>&quot;P&quot;</code>,</li> <li>uses the <a href="https://docs.mongodb.com/manual/reference/operator/update/currentDate/#up._S_currentDate" target="_blank" rel="noopener noreferrer"><code>$currentDate</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> operator to update the value of the <code>lastModified</code> field to the current date. If <code>lastModified</code> field does not exist, <a href="https://docs.mongodb.com/manual/reference/operator/update/currentDate/#up._S_currentDate" target="_blank" rel="noopener noreferrer"><code>$currentDate</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> will create the field. See <a href="https://docs.mongodb.com/manual/reference/operator/update/currentDate/#up._S_currentDate" target="_blank" rel="noopener noreferrer"><code>$currentDate</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> for details.</li></ul> <p><code>db.&lt;collection_name&gt;.replaceOne()</code> 方法替换除 <code>_id</code> 属性外的<strong>所有属性</strong>, 其<code>&lt;update&gt;</code>参数应为一个<strong>全新的文档</strong>.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>db<span class="token punctuation">.</span><span class="token operator">&lt;</span>collection_name<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token function">replaceOne</span><span class="token punctuation">(</span>
    <span class="token punctuation">{</span> item<span class="token operator">:</span> <span class="token string">&quot;paper&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> item<span class="token operator">:</span> <span class="token string">&quot;paper&quot;</span><span class="token punctuation">,</span> instock<span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token punctuation">{</span> warehouse<span class="token operator">:</span> <span class="token string">&quot;A&quot;</span><span class="token punctuation">,</span> qty<span class="token operator">:</span> <span class="token number">60</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> warehouse<span class="token operator">:</span> <span class="token string">&quot;B&quot;</span><span class="token punctuation">,</span> qty<span class="token operator">:</span> <span class="token number">40</span> <span class="token punctuation">}</span> <span class="token punctuation">]</span> <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
</code></pre></div><p><strong>批量修改</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 默认会修改第一条</span>
db<span class="token punctuation">.</span><span class="token operator">&lt;</span>collection_name<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span> userid<span class="token operator">:</span> <span class="token string">&quot;30&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> $<span class="token keyword">set</span> <span class="token punctuation">{</span>username<span class="token operator">:</span> <span class="token string">&quot;guest&quot;</span><span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 修改所有符合条件的数据</span>
db<span class="token punctuation">.</span><span class="token operator">&lt;</span>collection_name<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span> <span class="token punctuation">{</span> userid<span class="token operator">:</span> <span class="token string">&quot;30&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> $<span class="token keyword">set</span> <span class="token punctuation">{</span>username<span class="token operator">:</span> <span class="token string">&quot;guest&quot;</span><span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>multi<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span> <span class="token punctuation">)</span>
</code></pre></div><p><strong>列值增长的修改</strong></p> <p>如果我们想实现对某列值在原有值的基础上进行增加或减少，可以使用 <code>$inc</code> 运算符来实现</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>db<span class="token punctuation">.</span><span class="token operator">&lt;</span>collection_name<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span> _id<span class="token operator">:</span> <span class="token string">&quot;3&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>$inc<span class="token operator">:</span> <span class="token punctuation">{</span>likeNum<span class="token operator">:</span> <span class="token function">NumberInt</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>修改操作符</strong></p> <table><thead><tr><th style="text-align:left;">Name</th> <th style="text-align:left;">Description</th></tr></thead> <tbody><tr><td style="text-align:left;"><a href="https://docs.mongodb.com/manual/reference/operator/update/currentDate/#up._S_currentDate" target="_blank" rel="noopener noreferrer"><code>$currentDate</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></td> <td style="text-align:left;">Sets the value of a field to current date, either as a Date or a Timestamp.</td></tr> <tr><td style="text-align:left;"><a href="https://docs.mongodb.com/manual/reference/operator/update/inc/#up._S_inc" target="_blank" rel="noopener noreferrer"><code>$inc</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></td> <td style="text-align:left;">Increments the value of the field by the specified amount.</td></tr> <tr><td style="text-align:left;"><a href="https://docs.mongodb.com/manual/reference/operator/update/min/#up._S_min" target="_blank" rel="noopener noreferrer"><code>$min</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></td> <td style="text-align:left;">Only updates the field if the specified value is less than the existing field value.</td></tr> <tr><td style="text-align:left;"><a href="https://docs.mongodb.com/manual/reference/operator/update/max/#up._S_max" target="_blank" rel="noopener noreferrer"><code>$max</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></td> <td style="text-align:left;">Only updates the field if the specified value is greater than the existing field value.</td></tr> <tr><td style="text-align:left;"><a href="https://docs.mongodb.com/manual/reference/operator/update/mul/#up._S_mul" target="_blank" rel="noopener noreferrer"><code>$mul</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></td> <td style="text-align:left;">Multiplies the value of the field by the specified amount.</td></tr> <tr><td style="text-align:left;"><a href="https://docs.mongodb.com/manual/reference/operator/update/rename/#up._S_rename" target="_blank" rel="noopener noreferrer"><code>$rename</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></td> <td style="text-align:left;">Renames a field.</td></tr> <tr><td style="text-align:left;"><a href="https://docs.mongodb.com/manual/reference/operator/update/set/#up._S_set" target="_blank" rel="noopener noreferrer"><code>$set</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></td> <td style="text-align:left;">Sets the value of a field in a document.</td></tr> <tr><td style="text-align:left;"><a href="https://docs.mongodb.com/manual/reference/operator/update/setOnInsert/#up._S_setOnInsert" target="_blank" rel="noopener noreferrer"><code>$setOnInsert</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></td> <td style="text-align:left;">Sets the value of a field if an update results in an insert of a document. Has no effect on update operations that modify existing documents.</td></tr> <tr><td style="text-align:left;"><a href="https://docs.mongodb.com/manual/reference/operator/update/unset/#up._S_unset" target="_blank" rel="noopener noreferrer"><code>$unset</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></td> <td style="text-align:left;">Removes the specified field from a document.</td></tr></tbody></table> <h3 id="_2-1-4-删除-delete"><a href="#_2-1-4-删除-delete" class="header-anchor">#</a> 2.1.4 删除 Delete</h3> <ul><li>使用 <code>db.collection.deleteMany()</code> 方法删除所有匹配的文档.</li> <li>使用 <code>db.collection.deleteOne()</code> 方法删除单个匹配的文档.</li> <li><code>db.collection.drop()</code></li> <li><code>db.dropDatabase()</code></li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code>db<span class="token punctuation">.</span><span class="token operator">&lt;</span>collection_name<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token function">deleteMany</span><span class="token punctuation">(</span> <span class="token punctuation">{</span> qty <span class="token operator">:</span> <span class="token punctuation">{</span> $lt <span class="token operator">:</span> <span class="token number">50</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">)</span>
</code></pre></div><blockquote><p>Delete operations <strong>do not drop indexes</strong>, even if deleting all documents from a collection.</p> <p>一般数据库中的数据都不会真正意义上的删除，会添加一个字段，用来表示这个数据是否被删除</p></blockquote> <h3 id="_2-2-文档排序和投影（sort-projection）"><a href="#_2-2-文档排序和投影（sort-projection）" class="header-anchor">#</a> 2.2 文档排序和投影（sort &amp; projection）</h3> <h3 id="_2-2-1-排序-sort"><a href="#_2-2-1-排序-sort" class="header-anchor">#</a> 2.2.1 排序 Sort</h3> <p>在查询文档内容的时候，默认是按照 <code>_id</code> 进行排序</p> <p>我们可以用 <code>$sort</code> 更改文档排序规则</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span> $sort<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token operator">&lt;</span>field1<span class="token operator">&gt;</span><span class="token operator">:</span> <span class="token operator">&lt;</span>sort order<span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span>field2<span class="token operator">&gt;</span><span class="token operator">:</span> <span class="token operator">&lt;</span>sort order<span class="token operator">&gt;</span> <span class="token operator">...</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code>db<span class="token punctuation">.</span><span class="token operator">&lt;</span>collection_name<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token function">aggregate</span><span class="token punctuation">(</span>
   <span class="token punctuation">[</span>
     <span class="token punctuation">{</span> $sort <span class="token operator">:</span> <span class="token punctuation">{</span> age <span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> posts<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
     <span class="token comment">// ascending on posts and descending on age</span>
     <span class="token comment">// 1为正序 -1为倒叙</span>
   <span class="token punctuation">]</span>
<span class="token punctuation">)</span>
</code></pre></div><h3 id="_2-2-2-投影-projection"><a href="#_2-2-2-投影-projection" class="header-anchor">#</a> 2.2.2 投影 Projection</h3> <p>有些情况，我们对文档进行查询并不是需要所有的字段，比如只需要 id 或者 用户名，我们可以对文档进行“投影”</p> <ul><li><code>1</code> - display</li> <li><code>0</code> - don‘t display</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token operator">&gt;</span> db<span class="token punctuation">.</span><span class="token operator">&lt;</span>collection_name<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>username<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">}</span> <span class="token punctuation">)</span>

<span class="token operator">&gt;</span> db<span class="token punctuation">.</span><span class="token operator">&lt;</span>collection_name<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>age<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> _id<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">}</span> <span class="token punctuation">)</span>
</code></pre></div><h3 id="_2-3-foreach"><a href="#_2-3-foreach" class="header-anchor">#</a> 2.3 forEach()</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token operator">&gt;</span> db<span class="token punctuation">.</span><span class="token operator">&lt;</span>collection_name<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token function">fucntion</span><span class="token punctuation">(</span><span class="token parameter">doc</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'Blog Post: '</span> <span class="token operator">+</span> doc<span class="token punctuation">.</span>title<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="_2-4-其他查询方式"><a href="#_2-4-其他查询方式" class="header-anchor">#</a> 2.4 其他查询方式</h3> <h3 id="_2-4-1-正则表达式"><a href="#_2-4-1-正则表达式" class="header-anchor">#</a> 2.4.1 正则表达式</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code>$ db<span class="token punctuation">.</span><span class="token operator">&lt;</span>collection_name<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>field<span class="token operator">:</span><span class="token regex">/正则表达式/</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

$ db<span class="token punctuation">.</span><span class="token operator">&lt;</span>collection_name<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>字段<span class="token operator">:</span><span class="token regex">/正则表达式/</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="_2-4-2-比较查询"><a href="#_2-4-2-比较查询" class="header-anchor">#</a> 2.4.2 比较查询</h3> <p><code>&lt;</code>, <code>&lt;=</code>, <code>&gt;</code>, <code>&gt;=</code> 这些操作符也是很常用的，格式如下:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>db<span class="token punctuation">.</span><span class="token operator">&lt;</span>collection_name<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token string">&quot;field&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span> $gt<span class="token operator">:</span> value <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 大于: field &gt; value</span>
db<span class="token punctuation">.</span><span class="token operator">&lt;</span>collection_name<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token string">&quot;field&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span> $lt<span class="token operator">:</span> value <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 小于: field &lt; value</span>
db<span class="token punctuation">.</span><span class="token operator">&lt;</span>collection_name<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token string">&quot;field&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span> $gte<span class="token operator">:</span> value <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 大于等于: field &gt;= value</span>
db<span class="token punctuation">.</span><span class="token operator">&lt;</span>collection_name<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token string">&quot;field&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span> $lte<span class="token operator">:</span> value <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 小于等于: field &lt;= value</span>
db<span class="token punctuation">.</span><span class="token operator">&lt;</span>collection_name<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token string">&quot;field&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span> $ne<span class="token operator">:</span> value <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 不等于: field != value</span>
</code></pre></div><h3 id="_2-4-3-包含查询"><a href="#_2-4-3-包含查询" class="header-anchor">#</a> 2.4.3 包含查询</h3> <p>包含使用 <code>$in</code> 操作符。 示例：查询评论的集合中 <code>userid</code> 字段包含 <code>1003</code> 或 <code>1004</code>的文档</p> <div class="language-JavaScript extra-class"><pre class="language-javascript"><code>db<span class="token punctuation">.</span><span class="token operator">&lt;</span>collection_name<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>userid<span class="token operator">:</span><span class="token punctuation">{</span>$<span class="token keyword">in</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&quot;1003&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;1004&quot;</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>	
</code></pre></div><p>不包含使用 <code>$nin</code> 操作符。 示例：查询评论集合中 <code>userid</code> 字段不包含 <code>1003</code> 和 <code>1004</code> 的文档</p> <div class="language-JavaScript extra-class"><pre class="language-javascript"><code>db<span class="token punctuation">.</span><span class="token operator">&lt;</span>collection_name<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>userid<span class="token operator">:</span><span class="token punctuation">{</span>$nin<span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&quot;1003&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;1004&quot;</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="_2-5-常用命令小结"><a href="#_2-5-常用命令小结" class="header-anchor">#</a> 2.5 常用命令小结</h3> <div class="language-JavaScript extra-class"><pre class="language-javascript"><code>选择切换数据库：use articledb
插入数据：db<span class="token punctuation">.</span><span class="token operator">&lt;</span>collection_name<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">{</span>bson数据<span class="token punctuation">}</span><span class="token punctuation">)</span>
查询所有数据：db<span class="token punctuation">.</span><span class="token operator">&lt;</span>collection_name<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
条件查询数据：db<span class="token punctuation">.</span><span class="token operator">&lt;</span>collection_name<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>条件<span class="token punctuation">}</span><span class="token punctuation">)</span>
查询符合条件的第一条记录：db<span class="token punctuation">.</span><span class="token operator">&lt;</span>collection_name<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span>条件<span class="token punctuation">}</span><span class="token punctuation">)</span>
查询符合条件的前几条记录：db<span class="token punctuation">.</span><span class="token operator">&lt;</span>collection_name<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>条件<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span>条数<span class="token punctuation">)</span>
查询符合条件的跳过的记录：db<span class="token punctuation">.</span><span class="token operator">&lt;</span>collection_name<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>条件<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">skip</span><span class="token punctuation">(</span>条数<span class="token punctuation">)</span>

修改数据：db<span class="token punctuation">.</span><span class="token operator">&lt;</span>collection_name<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span>条件<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>修改后的数据<span class="token punctuation">}</span><span class="token punctuation">)</span>
        或
        db<span class="token punctuation">.</span><span class="token operator">&lt;</span>collection_name<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span>条件<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>$<span class="token keyword">set</span><span class="token operator">:</span><span class="token punctuation">{</span>要修改部分的字段<span class="token operator">:</span>数据<span class="token punctuation">}</span><span class="token punctuation">)</span>

修改数据并自增某字段值：db<span class="token punctuation">.</span><span class="token operator">&lt;</span>collection_name<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span>条件<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>$inc<span class="token operator">:</span><span class="token punctuation">{</span>自增的字段<span class="token operator">:</span>步进值<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

删除数据：db<span class="token punctuation">.</span><span class="token operator">&lt;</span>collection_name<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">{</span>条件<span class="token punctuation">}</span><span class="token punctuation">)</span>
统计查询：db<span class="token punctuation">.</span><span class="token operator">&lt;</span>collection_name<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">{</span>条件<span class="token punctuation">}</span><span class="token punctuation">)</span>
模糊查询：db<span class="token punctuation">.</span><span class="token operator">&lt;</span>collection_name<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>字段名<span class="token operator">:</span><span class="token regex">/正则表达式/</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
条件比较运算：db<span class="token punctuation">.</span><span class="token operator">&lt;</span>collection_name<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>字段名<span class="token operator">:</span><span class="token punctuation">{</span>$gt<span class="token operator">:</span>值<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
包含查询：db<span class="token punctuation">.</span><span class="token operator">&lt;</span>collection_name<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>字段名<span class="token operator">:</span><span class="token punctuation">{</span>$<span class="token keyword">in</span><span class="token operator">:</span><span class="token punctuation">[</span>值<span class="token number">1</span>，值<span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
        或
        db<span class="token punctuation">.</span><span class="token operator">&lt;</span>collection_name<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>字段名<span class="token operator">:</span><span class="token punctuation">{</span>$nin<span class="token operator">:</span><span class="token punctuation">[</span>值<span class="token number">1</span>，值<span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

条件连接查询：db<span class="token punctuation">.</span><span class="token operator">&lt;</span>collection_name<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>$and<span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span>条件<span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>条件<span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
           或
           db<span class="token punctuation">.</span><span class="token operator">&lt;</span>collection_name<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>$or<span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span>条件<span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>条件<span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="_3-文档间的对应关系"><a href="#_3-文档间的对应关系" class="header-anchor">#</a> 3. 文档间的对应关系</h2> <ul><li>一对一 (One To One)</li> <li>一对多 (One To Many)</li> <li>多对多 (Many To Many)</li></ul> <h2 id="_4-mongodb-的索引"><a href="#_4-mongodb-的索引" class="header-anchor">#</a> 4. MongoDB 的索引</h2> <p><strong>MongoDB 使用的是 B Tree, MySQL 使用的是 B+ Tree</strong></p> <div class="language-JavaScript extra-class"><pre class="language-javascript"><code><span class="token comment">// create index</span>
db<span class="token punctuation">.</span><span class="token operator">&lt;</span>collection_name<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token function">createIndex</span><span class="token punctuation">(</span><span class="token punctuation">{</span> userid <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> username <span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// retrieve indexes</span>
db<span class="token punctuation">.</span><span class="token operator">&lt;</span>collection_name<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token function">getIndexes</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// remove indexes</span>
db<span class="token punctuation">.</span><span class="token operator">&lt;</span>collection_name<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token function">dropIndex</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span>

<span class="token comment">// there are 2 ways to remove indexes:</span>
<span class="token comment">// 1. removed based on the index name</span>
<span class="token comment">// 2. removed based on the fields</span>

db<span class="token punctuation">.</span><span class="token operator">&lt;</span>collection_name<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token function">dropIndex</span><span class="token punctuation">(</span> <span class="token string">&quot;userid_1_username_-1&quot;</span> <span class="token punctuation">)</span>
db<span class="token punctuation">.</span><span class="token operator">&lt;</span>collection_name<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token function">dropIndex</span><span class="token punctuation">(</span><span class="token punctuation">{</span> userid <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> username <span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// remove all the indexes, will only remove non_id indexes</span>
db<span class="token punctuation">.</span><span class="token operator">&lt;</span>collection_name<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token function">dropIndexes</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="_4-1-索引的类型"><a href="#_4-1-索引的类型" class="header-anchor">#</a> 4.1 索引的类型</h3> <h3 id="_4-1-1-单字段索引（single-field-index）"><a href="#_4-1-1-单字段索引（single-field-index）" class="header-anchor">#</a> 4.1.1 单字段索引（Single Field Index）</h3> <blockquote><p>定义：在文档的单个字段上创建用户定义的**<code>升序/降序</code>**索引</p></blockquote> <p>对于单个字段索引和排序操作，索引值的排序顺序（即升序或降序）并不重要，因为MongoDB可以在任何方向上遍历索引</p> <h3 id="_4-1-2-复合索引（compound-index）"><a href="#_4-1-2-复合索引（compound-index）" class="header-anchor">#</a> 4.1.2 复合索引（Compound Index）</h3> <blockquote><p>定义：支持用户自定义多个索引</p></blockquote> <h3 id="_4-1-3-其他索引"><a href="#_4-1-3-其他索引" class="header-anchor">#</a> 4.1.3 其他索引</h3> <ul><li>地理空间索引 Geospatial Index</li> <li>文本索引 Text Indexes</li> <li>哈希索引 Hashed Indexes</li></ul> <p><strong>地理空间索引（Geospatial Index）</strong></p> <p>为了支持对地理空间坐标数据的有效查询，MongoDB 提供了两种特殊的索引: 返回结果时使用平面几何的二维索引和返回结果时使用球面几何的二维球面索引。</p> <p><strong>文本索引（Text Indexes）</strong></p> <p>MongoDB 提供了一种文本索引类型，支持在集合中搜索字符串内容。这些文本索引不存储特定于语言的停止词（例如 “the”, “a”, “or”）， 而将集合中的词作为词干，只存储根词。</p> <p><strong>哈希索引（Hashed Indexes）</strong></p> <p>为了支持基于散列的分片，MongoDB 提供了散列索引类型，它对字段值的散列进行索引。这些索引在其范围内的值分布更加随机，但只支持相等匹配，不支持基于范围的查询。</p> <h3 id="_4-2-索引的管理操作"><a href="#_4-2-索引的管理操作" class="header-anchor">#</a> 4.2 索引的管理操作</h3> <h3 id="_4-2-1-索引的查看"><a href="#_4-2-1-索引的查看" class="header-anchor">#</a> 4.2.1 索引的查看</h3> <div class="language-JavaScript extra-class"><pre class="language-javascript"><code><span class="token comment">//基础语法：</span>
db<span class="token punctuation">.</span><span class="token operator">&lt;</span>collection_name<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token function">getIndexes</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="_4-2-2-索引的创建"><a href="#_4-2-2-索引的创建" class="header-anchor">#</a> 4.2.2 索引的创建</h3> <div class="language-JavaScript extra-class"><pre class="language-javascript"><code><span class="token comment">//基础语法：</span>
db<span class="token punctuation">.</span><span class="token operator">&lt;</span>collection_name<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token function">createIndex</span><span class="token punctuation">(</span>keys<span class="token punctuation">,</span> options<span class="token punctuation">)</span>
</code></pre></div><blockquote><p>参数：</p></blockquote> <p><img src="/assets/img/4.2.2.cd37b44c.png" alt="image"></p> <blockquote><p>options（更多选项）列表：</p></blockquote> <table><thead><tr><th>Parameter</th> <th>Type</th> <th>Description</th></tr></thead> <tbody><tr><td>background</td> <td>Boolean</td> <td>建索引过程会阻塞其他数据库操作，background可指定用后台方式创建索引，即增加“background”可选参数。“background”默认值为<strong>false</strong></td></tr> <tr><td>unique</td> <td>Boolean</td> <td>建立的索引是否唯一。指定为true创建唯一索引。默认是为<strong>false</strong></td></tr> <tr><td>name</td> <td>string</td> <td>索引的名称。如果未指定，MongoDB会通过连接索引的字段名和排序顺序生成一个索引名称。</td></tr> <tr><td>dropDups</td> <td>Boolean</td> <td><strong>3.0+版本已废弃</strong>。在建立唯一索引时是否删除重复记录，指定true创建唯一索引。默认值为<strong>false</strong></td></tr> <tr><td>sparse</td> <td>Boolean</td> <td>对文档中不存在的字段数据不启用索引；这个参数需要注意：如果设置为<strong>true</strong>的话，在索引字段中不会查出不包含对应字段的文档。默认值为<strong>false</strong></td></tr> <tr><td>expireAfterSeconds</td> <td>integer</td> <td>指定一个以秒为单位的数值，完成<strong>TTL</strong>设定，设定集合的生存时间。</td></tr> <tr><td>v</td> <td>index version</td> <td>索引的版本号。默认的索引版本取决于mongodb创建索引时运行的版本。</td></tr> <tr><td>weights</td> <td>document</td> <td>索引权重值，数值在1~99,999之间，表示该索引相对其他索引字段的得分权重</td></tr> <tr><td>default_language</td> <td>string</td> <td>对于文本索引，该参数决定了停用词及词干和词器的规则的列表。默认为英语</td></tr> <tr><td>language_override</td> <td>string</td> <td>对于文本索引，该参数指定了包含在文档中的字段名，语言覆盖默认的language，默认值为language</td></tr></tbody></table> <p>注意在 3.0.0 版本前创建索引方法为 <code>db.collection.ensureIndex()</code> ，之后的版本使用了 <code>db.collection.createIndex()</code> 方法， <code>ensureIndex()</code> 还能用，但只是 <code>createIndex()</code> 的别名。</p> <p>举个🌰</p> <div class="language-JavaScript extra-class"><pre class="language-javascript"><code>$  db<span class="token punctuation">.</span><span class="token operator">&lt;</span>collection_name<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token function">createIndex</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>userid<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token string">&quot;createdCollectionAutomatically&quot;</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token string">&quot;numIndexesBefore&quot;</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token string">&quot;numIndexesAfter&quot;</span> <span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
  <span class="token string">&quot;ok&quot;</span> <span class="token operator">:</span> <span class="token number">1</span>
<span class="token punctuation">}</span>

$ db<span class="token punctuation">.</span><span class="token operator">&lt;</span>collection_name<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token function">createIndex</span><span class="token punctuation">(</span><span class="token punctuation">{</span>userid<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span>nickname<span class="token operator">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token operator">...</span>
</code></pre></div><h3 id="_4-2-3-索引的删除"><a href="#_4-2-3-索引的删除" class="header-anchor">#</a> 4.2.3 索引的删除</h3> <div class="language-JavaScript extra-class"><pre class="language-javascript"><code># 删除某一个索引
$ db<span class="token punctuation">.</span>collection<span class="token punctuation">.</span><span class="token function">dropIndex</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span>

# 删除全部索引
$ db<span class="token punctuation">.</span>collection<span class="token punctuation">.</span><span class="token function">dropIndexes</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>提示：</strong></p> <p><code>_id</code> 的字段的索引是无法删除的，只能删除非 <code>_id</code> 字段的索引</p> <div class="language-JavaScript extra-class"><pre class="language-javascript"><code># 删除 comment 集合中 userid 字段上的升序索引
$ db<span class="token punctuation">.</span>comment<span class="token punctuation">.</span><span class="token function">dropIndex</span><span class="token punctuation">(</span><span class="token punctuation">{</span>userid<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="_4-3-索引的使用"><a href="#_4-3-索引的使用" class="header-anchor">#</a> 4.3 索引的使用</h3> <h3 id="_4-3-1-执行计划"><a href="#_4-3-1-执行计划" class="header-anchor">#</a> 4.3.1 执行计划</h3> <p>分析查询性能 (Analyse Query Performance) 通常使用执行计划 (解释计划 - Explain Plan) 来查看查询的情况</p> <div class="language-JavaScript extra-class"><pre class="language-javascript"><code>$ db<span class="token punctuation">.</span><span class="token operator">&lt;</span>collection_name<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span> query<span class="token punctuation">,</span> options <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">explain</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span>
</code></pre></div><h3 id="_4-3-2-涵盖的查询"><a href="#_4-3-2-涵盖的查询" class="header-anchor">#</a> 4.3.2 涵盖的查询</h3> <p>当查询条件和查询的投影仅包含索引字段是, MongoDB 直接从索引返回结果, 而不扫描任何文档或将文档带入内存, 这些覆盖的查询十分有效</p> <p><img src="/assets/img/4.3.2.d4fa6ce4.png" alt="image"></p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.294fffad.js" defer></script><script src="/assets/js/2.f1532a20.js" defer></script><script src="/assets/js/4.1433da08.js" defer></script>
  </body>
</html>
